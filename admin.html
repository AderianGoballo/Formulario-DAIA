<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Administración</title>
  <script src="https://cdn.tailwindcss.com/3.3.5"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --color-dark-blue: #1A202C;
      --color-medium-blue: #2B6CB0;
      --color-light-blue: #90CDF4;
      --color-white: #FFFFFF;
      --color-gray-bg: #F7FAFC;
      --color-answered: #68D391;
      --color-pending: #F6AD55;
      --color-footer: #1A2B3C;
    }
    /* ...estilos existentes sin cambios... */
  </style>
</head>
<body>
  <!-- Cabecera -->
  <!-- ...contenido HTML existente sin cambios... -->

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxNqPPsg5mHBPR0bWH8zQuHL2BHYXEFFxCCv_rNRIYvg6YH7QQbjD6Ho7GOJlRY6F23BQ/exec';
    const CLAVE_ADMIN = 'admin123';

    document.addEventListener('DOMContentLoaded', function() {
      const carruseles = document.querySelectorAll('.carrusel');
      let actual = 0;

      if (carruseles.length > 1) {
        setInterval(() => {
          carruseles[actual].classList.remove('active');
          actual = (actual + 1) % carruseles.length;
          carruseles[actual].classList.add('active');
        }, 5000);
      }

      cargarDisciplinas();
      cargarFacultades();
      cargarAtletas();
      cargarEscuelas();
    });

    async function agregarItem(tipo, data) {
      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tipo, ...data, adminKey: CLAVE_ADMIN }),
          mode: 'cors'
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || 'Error del servidor');
        }

        const result = await response.json();
        if (result.status !== 'ok') throw new Error(result.message);

        return true;
      } catch (error) {
        console.error(`Error al agregar ${tipo}:`, error);
        alert(`Error: ${error.message}`);
        return false;
      }
    }

    async function eliminarItem(tipo, id) {
      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tipo: `delete${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`, id, adminKey: CLAVE_ADMIN }),
          mode: 'cors'
        });

        const result = await response.json();
        if (result.status !== 'ok') throw new Error(result.message);
        return true;
      } catch (error) {
        console.error(`Error eliminando ${tipo}:`, error);
        alert(`Error: ${error.message}`);
        return false;
      }
    }

    async function cargarDatos(tipo, params = {}) {
      try {
        const urlParams = new URLSearchParams({ tipo, ...params }).toString();
        const response = await fetch(`${SCRIPT_URL}?${urlParams}`);
        const data = await response.json();
        if (data.status !== 'ok') throw new Error(data.message);
        return data;
      } catch (error) {
        console.error(`Error cargando ${tipo}:`, error);
        alert(`Error: ${error.message}`);
        return null;
      }
    }

    async function cargarDisciplinas() {
      const data = await cargarDatos('getDisciplinas');
      if (!data || !data.data) return;

      const lista = document.getElementById('lista-disciplinas');
      if (lista) {
        lista.innerHTML = data.data.map(d => 
          `<li class="admin-list-item">
            <span>${d.nombre}</span>
            <button class="text-red-500 hover:text-red-700" data-id="${d.id}" data-tipo="disciplina">
              <i class="fas fa-trash"></i>
            </button>
          </li>`
        ).join('');
      }

      const select = document.getElementById('select-disciplina');
      if (select) {
        select.innerHTML = '<option value="">Seleccione una disciplina</option>' +
          data.data.map(d => `<option value="${d.id}">${d.nombre}</option>`).join('');
      }
    }

    async function cargarAtletas() {
      const data = await cargarDatos('getAllAtletas');
      if (!data || !data.data) return;

      const lista = document.getElementById('lista-atletas');
      if (lista) {
        lista.innerHTML = data.data.map(a => 
          `<li class="admin-list-item">
            <div>
              <div class="font-medium">${a.nombre}</div>
              <div class="text-sm text-gray-600">${a.disciplinaNombre || 'Sin disciplina'}</div>
              <div class="text-xs ${a.respondido ? 'text-green-600' : 'text-yellow-600'}">
                ${a.respondido ? '✓ Respondido' : 'Pendiente'}
              </div>
            </div>
            <button class="text-red-500 hover:text-red-700" data-id="${a.id}" data-tipo="atleta">
              <i class="fas fa-trash"></i>
            </button>
          </li>`
        ).join('');
      }
    }

    async function cargarFacultades() {
      const data = await cargarDatos('getFacultades');
      if (!data || !data.data) return;

      const lista = document.getElementById('listaFacultades');
      if (lista) {
        lista.innerHTML = data.data.map(f => 
          `<li class="admin-list-item">
            <span>${f.nombre}</span>
            <button class="text-red-500 hover:text-red-700" data-id="${f.id}" data-tipo="facultad">
              <i class="fas fa-trash"></i>
            </button>
          </li>`
        ).join('');
      }

      const select = document.getElementById('selectFacultades');
      if (select) {
        select.innerHTML = '<option value="">Seleccione una facultad</option>' +
          data.data.map(f => `<option value="${f.id}">${f.nombre}</option>`).join('');
      }
    }

    async function cargarEscuelas() {
      const facultadSelect = document.getElementById('selectFacultades');
      const facultadId = facultadSelect ? facultadSelect.value : null;
      if (!facultadId) {
        const lista = document.getElementById('listaEscuelas');
        if (lista) lista.innerHTML = '';
        return;
      }

      const data = await cargarDatos('getEscuelas', { facultadId });
      if (!data || !data.data) return;

      const lista = document.getElementById('listaEscuelas');
      if (lista) {
        lista.innerHTML = data.data.map(e => 
          `<li class="admin-list-item">
            <div>
              <div class="font-medium">${e.nombre}</div>
              <div class="text-sm text-gray-600">${e.facultadNombre || 'Sin facultad'}</div>
            </div>
            <button class="text-red-500 hover:text-red-700" data-id="${e.id}" data-tipo="escuela">
              <i class="fas fa-trash"></i>
            </button>
          </li>`
        ).join('');
      }
    }
  </script>
</body>
</html>
